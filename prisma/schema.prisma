generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  ARTISAN
  ADMIN
}

enum OtpChannel {
  PHONE
  EMAIL
  WHATSAPP
}

enum ArtisanStatus {
  PENDING
  APPROVED
  REJECTED
}


model User {
  id          Int      @id @default(autoincrement())
  fullName    String
  phoneNumber String   @unique
  email       String?  @unique   
  password    String
  isVerified  Boolean  @default(false)
  role        Role     @default(USER)

  artisanStatus ArtisanStatus?   
  artisanApprovedAt DateTime?    
  artisanRejectionReason String?

  failedLoginAttempts Int      @default(0)
  lockUntil           DateTime?
  refreshToken        String?  

  createdAt   DateTime @default(now())

  otps Otp[]
}


model Otp {
  id         Int        @id @default(autoincrement())
  identifier String
  channel    OtpChannel
  code       String
  expiresAt  DateTime
  isUsed     Boolean    @default(false)
  createdAt  DateTime   @default(now())

  userId Int?
  user   User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([identifier])
  @@index([userId])
}


